<html lang="en-us">
  <head>
    <script src="/js/all.min.js"></script>
    <meta charset="utf-8" />
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <meta
      content="width=device-width, initial-scale=1, shrink-to-fit=no, minimum-scale=1, maximum-scale=1"
      name="viewport"
    />
    <title>Balatro</title>
    <meta
      content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self'; media-src 'self'; object-src 'none'; base-uri 'none'; form-action 'self'; worker-src 'self' blob:; frame-ancestors 'self'; upgrade-insecure-requests; block-all-mixed-content"
      http-equiv="Content-Security-Policy"
    />
    <meta content="no-referrer" http-equiv="Referrer-Policy" />
    <meta content="SAMEORIGIN" http-equiv="X-Frame-Options" />
    <meta content="same-origin" http-equiv="Cross-Origin-Resource-Policy" />
    <!-- Load custom style sheet -->
    <link href="css/love.css" rel="stylesheet" type="text/css" />
    <script src="js/consolewrapper.js"></script>
  </head>
  <body>
    <center>
      <div>
        <!-- <h1>Balatro</h1> -->
        <canvas
          id="loadingCanvas"
          oncontextmenu="event.preventDefault()"
          width="1920"
          height="1080"
        ></canvas>
        <canvas id="canvas" oncontextmenu="event.preventDefault()"></canvas>
      </div>
    </center>
    <script type="text/javascript">
      window.callad = () => {
        /* disabled */
      };

      var canvas = document.getElementById("loadingCanvas");
      canvas.width = 1920; // Set to 1920x1080 initially
      canvas.height = 1080; // Set to 1920x1080 initially

      function goFullScreen() {
        var canvas = document.getElementById("canvas");
        if (canvas.requestFullscreen) {
          canvas.requestFullscreen();
        } else if (canvas.webkitRequestFullscreen) {
          canvas.webkitRequestFullscreen();
        } else if (canvas.mozRequestFullScreen) {
          canvas.mozRequestFullScreen();
        }
      }

      // Update canvas size during fullscreen
      function FullScreenHook() {
        var canvas = document.getElementById("canvas");
        if (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement) {
          // In fullscreen mode, set to the current window size
          canvas.width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
          canvas.height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
        } else {
          // Not fullscreen, reset to 1920x1080
          canvas.width = 1920;
          canvas.height = 1080;
        }
      }

      // Add fullscreen change listener to adjust canvas size
      document.addEventListener("fullscreenchange", FullScreenHook);
      document.addEventListener("webkitfullscreenchange", FullScreenHook);
      document.addEventListener("mozfullscreenchange", FullScreenHook);

      var loadingContext = document.getElementById("loadingCanvas").getContext("2d");

      function drawLoadingText(text) {
        var canvas = loadingContext.canvas;

        loadingContext.fillStyle = "rgb(142, 195, 227)";
        loadingContext.fillRect(0, 0, canvas.scrollWidth, canvas.scrollHeight);

        loadingContext.font = "2em arial";
        loadingContext.textAlign = "center";
        loadingContext.fillStyle = "rgb( 11, 86, 117 )";
        loadingContext.fillText(text, canvas.scrollWidth / 2, canvas.scrollHeight / 2);

        // loadingContext.fillText("Powered By Emscripten.", canvas.scrollWidth / 2, canvas.scrollHeight / 4);
        // loadingContext.fillText("Powered By LÃ–VE.", canvas.scrollWidth / 2, canvas.scrollHeight / 4 * 3);
      }

      window.onload = function () {
        window.focus();
      };
      window.onclick = function () {
        window.focus();
      };

      window.addEventListener(
        "keydown",
        function (e) {
          // space and arrow keys
          if ([32, 37, 38, 39, 40].indexOf(e.keyCode) > -1) {
            e.preventDefault();
          }
        },
        false
      );

      var Module = {
        arguments: ["./game.love"],
        INITIAL_MEMORY: 256000000,
        printErr: console.error.bind(console),
        canvas: (function () {
          var canvas = document.getElementById("canvas");

          // As a default initial behavior, pop up an alert when webgl context is lost.
          // See http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.2
          canvas.addEventListener(
            "webglcontextlost",
            function (e) {
              alert("WebGL context lost. You will need to reload the page.");
              e.preventDefault();
            },
            false
          );

          return canvas;
        })(),
        setStatus: function (text) {
          if (text) {
            drawLoadingText(text);
          } else if (Module.remainingDependencies === 0) {
            document.getElementById("loadingCanvas").style.display = "none";
            document.getElementById("canvas").style.visibility = "visible";
          }
        },
        totalDependencies: 0,
        remainingDependencies: 0,
        monitorRunDependencies: function (left) {
          this.remainingDependencies = left;
          this.totalDependencies = Math.max(this.totalDependencies, left);
          Module.setStatus(
            left
              ? "Preparing... (" + (this.totalDependencies - left) + "/" + this.totalDependencies + ")"
              : "All downloads complete."
          );
        },
      };
      Module.setStatus("Downloading...");
      window.onerror = function (event) {
        // TODO: do not warn on ok events like simulating an infinite loop or exitStatus
        Module.setStatus("Exception thrown, see JavaScript console");
        Module.setStatus = function (text) {
          if (text) Module.printErr("[post-exception status] " + text);
        };
      };

      var applicationLoad = function (e) {
        Love(Module);
      };
    </script>
    <script src="js/game.js" type="text/javascript"></script>
    <script async="" onload="applicationLoad(this)" src="js/love.js" type="text/javascript"></script>
    <script type="text/javascript">
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", function () {
          navigator.serviceWorker
            .register("./sw.js")
            .catch(function (err) {
              console.error("SW registration failed:", err);
            });
        });
      }
    </script>
    <!--
      References:
      - https://github.com/Davidobot/love.js
      - https://balatro-online.com/
      - https://game.randplays.com/balatro-online/index.html
    -->
  </body>
</html>
